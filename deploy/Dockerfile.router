FROM golang:1.26-alpine AS builder
WORKDIR /src
COPY . .
ARG VERSION=dev
ARG COMMIT=none
ARG BUILD_DATE=unknown
RUN CGO_ENABLED=0 go build -ldflags="-s -w -X github.com/your-org/fluxroute/internal/version.Version=${VERSION} -X github.com/your-org/fluxroute/internal/version.Commit=${COMMIT} -X github.com/your-org/fluxroute/internal/version.BuildDate=${BUILD_DATE}" -o /bin/fluxroute ./cmd/router

FROM scratch
COPY --from=builder /bin/fluxroute /fluxroute
ENTRYPOINT ["/fluxroute"]
